{%load static %}

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">

    <title>INVENTORY MANAGEMENT</title>
    <meta content="" name="description">
    <meta content="" name="keywords">

    <!-- Favicons -->
    <link href={% static '/assets/img/favicon.png' %} rel="icon">
    <link href={% static '/assets/img/apple-touch-icon.png' %} rel="apple-touch-icon">

    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

    <!-- Google Fonts -->
    <link href="https://fonts.gstatic.com" rel="preconnect">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Nunito:300,300i,400,400i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i"
        rel="stylesheet">

    <!-- Vendor CSS Files -->
    <link href={% static 'assets/vendor/bootstrap/css/bootstrap.min.css' %} rel="stylesheet">
    <link href={% static 'assets/vendor/bootstrap-icons/bootstrap-icons.css' %} rel="stylesheet">

    <!-- Template Main CSS File -->
    <link href={% static 'assets/css/style.css' %} rel="stylesheet">

    <!-- ===== DataTables Js and CSS File ===== -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.js"></script>
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.css">
    <!-- =============APEXCHARTS============ -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.js">
    </script>
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>

</head>

<body style="height: 100% ;overflow: hidden;">
    <!-- ======= Header ======= -->
    <header id="header" class="header fixed-top d-flex align-items-center">

        <div class="d-flex align-items-center justify-content-between">
            <a class="logo d-flex align-items-center">
                <img src={% static 'assets/img/logo1.png' %} alt="">
                <span style="color:rgb(227, 148, 64);font-weight:bold;font-size:3vh;">INVENTORY_MANAGEMENT</span>
            </a>
            <i class="bi bi-list toggle-sidebar-btn"></i>
        </div><!-- End Logo -->

    </header><!-- End Header -->

    <!-- ===== Sidebar ===== -->
    <aside id="sidebar" class="sidebar">
        <ul class="sidebar-nav" id="sidebar-nav">
            <li class="nav-item" style="width: 40vh;">
                <a class="nav-link " href="dashboard_page">
                    <i class="bi bi-houses-fill" style="color: #d59124"></i>
                    <span style="color: #d59124;font-size:2.5vh;">Dashboard</span>
                </a>
                <a class="nav-link " href="cylindrical">
                    <i class="bi bi-gear-fill" style="color: #d59124"></i>
                    <span style="color: #d59124;font-size:2.5vh;">Tank Inventory</span>
                </a>
                <a class="nav-link " href="#">
                    <i class="bi bi-file-earmark-text" style="color: #d59124"></i>
                    <span style="color: #d59124;font-size:2.5vh;">Reports</span>
                </a>
            </li>
        </ul>
    </aside>
    <main id="main" class="main">
        <section class="section dashboard">
            <div class="row">
                <!-- <div class="col-lg-12" style="height:10vh;width:65.3vh"> -->
                <div
                    style="border:1px solid rgb(215, 24, 24);margin-left: 0.5vh;float: left;width:99.5%;cursor: pointer;height: 85vh;">
                    <div style="margin-top: 2%;">
                        <h6 style="font-size: 4vh;font-style:normal;font-weight:bolder;margin-left:2vh ;">Trend</h6>
                    </div>

                    <div id="Div1" col-lg-12 style="height: 100vh;">
                        <canvas id="myChart"
                            style="width:100vh;max-width:100vh;margin-left: 35vh;margin-top: 5vh;height: 60vh;"></canvas>

                        <script>
                            document.getElementById("Div1").addEventListener("dblclick", function () {
                                window.location.href = "alltag";
                            });
                            // Define a global variable to store the chart instance
                            let myChart;

                            const xValues = ["Tag1", "Tag2", "Tag3", "Tag4", "Tag5", "Tag6", "Tag7", "Tag8"];
                            const yValues = [55, 49, 44, 24, 12, 55, 54, 54];

                            // Create the initial chart
                            createChart();

                            function createChart() {
                                myChart = new Chart("myChart", {
                                    type: "bar",
                                    data: {
                                        labels: xValues,
                                        datasets: [{
                                            backgroundColor: ["black", "black", "black", "black", "black", "black", "black", "black",],
                                            data: yValues
                                        }]
                                    },
                                    options: {
                                        legend: { display: false },
                                        title: {
                                            display: true,
                                            text: "Level in tanks"
                                        },
                                        onClick: function (event, elements) {
                                            // Handle the bar click event
                                            if (elements.length > 0) {
                                                // Check if the clicked element is "Tag1"
                                                if (elements[0]._model.label === "Tag1") {
                                                    // Redirect to the desired URL (replace 'your_url_here' with the actual URL)
                                                    window.location.href = '/Tag1';
                                                } else if (elements[0]._model.label === "Tag2") {
                                                    window.location.href = '/Tag2';
                                                } else if (elements[0]._model.label === "Tag3") {
                                                    window.location.href = '/Tag3';
                                                } else if (elements[0]._model.label === "Tag4") {
                                                    window.location.href = '/Tag4';
                                                } else if (elements[0]._model.label === "Tag5") {
                                                    window.location.href = '/Tag5';
                                                } else if (elements[0]._model.label === "Tag6") {
                                                    window.location.href = '/Tag6';
                                                } else if (elements[0]._model.label === "Tag7") {
                                                    window.location.href = '/Tag7';
                                                } else if (elements[0]._model.label === "Tag8") {
                                                    window.location.href = '/Tag8';
                                                }


                                            }
                                        }

                                    },
                                });
                            }
                            function fetchDataAndRefreshChart() {
                                $.ajax({
                                    url: 'data',  // Replace with the actual URL of your API endpoint
                                    type: 'GET',
                                    dataType: 'json',
                                    success: function (response) {
                                        var all_tag_data = response.all_tag_values;

                                        // Update yValues with the fetched data
                                        for (var i = 0; i < all_tag_data.length; i++) {
                                            yValues[i] = all_tag_data[i];
                                        }

                                        // Check if the chart instance exists before updating
                                        if (myChart) {
                                            updateChart();
                                        } else {
                                            createChart();
                                        }
                                    },
                                    error: function (error) {
                                        console.error('Error fetching data:', error);
                                    }
                                });
                            }
                            fetchDataAndRefreshChart()
                            setInterval(fetchDataAndRefreshChart, 2000);
                            function updateChart() {
                                // Update the chart's dataset with the new yValues
                                myChart.data.datasets[0].data = yValues;

                                // Update the chart
                                myChart.update();
                            }


                        </script>

                    </div>

                </div>
                <!-- </div> -->
            </div>

        </section>
    </main>


    <!-- Vendor JS Files -->
    <script src= {% static 'assets/vendor/apexcharts/apexcharts.min.js' %}></script>
    <script src= {% static 'assets/vendor/bootstrap/js/bootstrap.bundle.min.js' %}></script>
    <script src= {% static 'assets/vendor/chart.js/chart.umd.js' %}></script>
    <script src= {% static 'assets/vendor/echarts/echarts.min.js' %}></script>
    <script src= {% static 'assets/vendor/quill/quill.min.js' %}></script>
    <script src= {% static 'assets/vendor/simple-datatables/simple-datatables.js' %}></script>
    <script src= {% static 'assets/vendor/tinymce/tinymce.min.js' %}></script>

    <!-- Template Main JS File -->
    <!-- <script src={% static 'assets/js/main.js' %} type="text/javascript"></script> -->
    <script src= {% static 'assets/js/main.js' %}></script>

</body>

</html>